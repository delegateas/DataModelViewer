# Data Model Viewer - Project Context

> **Generated**: 2025-11-06
> **Version**: 2.2.2
> **Purpose**: Comprehensive reference for understanding the Data Model Viewer codebase

## ğŸ“‹ Quick Summary

**Data Model Viewer** is an enterprise web application that visualizes Microsoft Dataverse (Dynamics 365) metadata. It provides interactive entity relationship diagrams, comprehensive metadata browsing, and analytics for understanding data models and security configurations.

**Architecture**: Hybrid C#/.NET generator + Next.js 15 React frontend

## ğŸ—ï¸ Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     USER INTERACTION                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Next.js 15 Frontend     â”‚
         â”‚   (React 19 + TypeScript) â”‚
         â”‚                           â”‚
         â”‚  â€¢ JointJS Diagrams       â”‚
         â”‚  â€¢ MUI Components         â”‚
         â”‚  â€¢ Tailwind CSS 4         â”‚
         â”‚  â€¢ Web Workers (routing)  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚    generated/Data.ts      â”‚
         â”‚    (1.5MB metadata)       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  C# .NET 8 Generator      â”‚
         â”‚                           â”‚
         â”‚  â€¢ Dataverse SDK          â”‚
         â”‚  â€¢ Azure Identity         â”‚
         â”‚  â€¢ Plugin Analysis        â”‚
         â”‚  â€¢ Flow Analysis          â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Microsoft Dataverse     â”‚
         â”‚   (Dynamics 365)          â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—‚ï¸ Directory Structure

```
DataModelViewer/
â”œâ”€â”€ Generator/              # C# .NET 8 - Metadata extraction & analysis
â”‚   â”œâ”€â”€ DTO/               # Data Transfer Objects (entities, attributes, etc.)
â”‚   â”œâ”€â”€ Services/          # Plugin, Flow, WebResource analyzers
â”‚   â”œâ”€â”€ Queries/           # Dataverse query definitions
â”‚   â”œâ”€â”€ DataverseService.cs    # Main Dataverse interaction
â”‚   â”œâ”€â”€ WebsiteBuilder.cs      # Generates Data.ts
â”‚   â””â”€â”€ Program.cs             # Entry point
â”‚
â”œâ”€â”€ Website/               # Next.js 15 - Frontend application
â”‚   â”œâ”€â”€ app/              # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ api/          # API routes (auth, diagram CRUD)
â”‚   â”‚   â”œâ”€â”€ diagram/      # Diagram editor page
â”‚   â”‚   â”œâ”€â”€ metadata/     # Entity metadata viewer
â”‚   â”‚   â”œâ”€â”€ insights/     # Analytics pages
â”‚   â”‚   â””â”€â”€ processes/    # Process explorer
â”‚   â”‚
â”‚   â”œâ”€â”€ components/       # React components
â”‚   â”‚   â”œâ”€â”€ diagramview/  # Diagram editor (JointJS integration)
â”‚   â”‚   â”œâ”€â”€ datamodelview/    # Metadata browser
â”‚   â”‚   â”œâ”€â”€ insightsview/     # Analytics components
â”‚   â”‚   â””â”€â”€ shared/           # Shared UI components
â”‚   â”‚
â”‚   â”œâ”€â”€ contexts/         # React Context providers
â”‚   â”‚   â”œâ”€â”€ AuthContext.tsx          # Session management
â”‚   â”‚   â”œâ”€â”€ DatamodelDataContext.tsx # Metadata loading
â”‚   â”‚   â”œâ”€â”€ DiagramViewContext.tsx   # Diagram state
â”‚   â”‚   â””â”€â”€ SettingsContext.tsx      # User preferences
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/             # Utilities and services
â”‚   â”‚   â”œâ”€â”€ diagram/     # Diagram serialization, helpers
â”‚   â”‚   â”œâ”€â”€ Types.ts     # Core type definitions
â”‚   â”‚   â””â”€â”€ session.ts   # JWT session management
â”‚   â”‚
â”‚   â”œâ”€â”€ generated/       # Generated by C# Generator
â”‚   â”‚   â””â”€â”€ Data.ts      # Entity metadata (1.5MB)
â”‚   â”‚
â”‚   â””â”€â”€ middleware.ts    # Authentication middleware
â”‚
â”œâ”€â”€ Infrastructure/      # Azure Bicep (App Service deployment)
â””â”€â”€ azure-pipelines-*.yml   # CI/CD pipelines
```

## ğŸ”‘ Key Technologies

### Backend (Generator)
- **.NET 8.0** with C# 13
- **Microsoft.PowerPlatform.Dataverse.Client** (v1.2.2) - Dataverse connectivity
- **Azure.Identity** (v1.13.1) - Authentication via DefaultAzureCredential
- **System.Linq.Dynamic.Core** - Dynamic queries

### Frontend (Website)
- **Next.js 15** with App Router + **React 19** + **TypeScript 5**
- **JointJS (@joint/core v4.1.3)** - Interactive diagram editor
- **libavoid-js (v0.4.5)** - Orthogonal routing via WebAssembly
- **MUI v7** - Material Design components
- **Tailwind CSS 4** - Utility-first styling (new @layer syntax)
- **Nivo** - Data visualization charts
- **jose** - JWT session management

### Infrastructure
- **Azure App Service** (Node 24 LTS on Linux)
- **Azure Managed Identity** - Production authentication
- **Azure DevOps Git** - Diagram storage & versioning
- **Azure Bicep** - Infrastructure as Code

## ğŸ¯ Core Workflows

### 1. Data Generation Flow

```
appsettings.local.json
  â†“
DataverseService (C#)
  â†“ [Azure DefaultAzureCredential]
Microsoft Dataverse
  â†“ [Metadata queries]
DataverseService.GetFilteredMetadata()
  â†“ [Filter by solutions]
PluginAnalyzer, FlowAnalyzer, WebResourceAnalyzer
  â†“
WebsiteBuilder.AddData()
  â†“
Website/generated/Data.ts (TypeScript)
```

**Generated Data Structure:**
```typescript
export const EntityGroups: Map<string, EntityType[]>
export const Warnings: SolutionWarningsList[]
export const SolutionComponents: SolutionComponentList[]
export const timestamp: string
export const logo: string | null
```

### 2. Diagram Editing Flow

```
User adds entity
  â†“
DiagramViewContext.addEntity()
  â†“
createEntity() â†’ EntityElement (JointJS)
  â†“
graph.addCell(entityElement)
  â†“
AvoidRouter detects change
  â†“
Web Worker calculates routes (libavoid WASM)
  â†“
Main thread receives route vertices
  â†“
Updates RelationshipLink vertices
  â†“
User saves â†’ Serializes to JSON
  â†“
POST /api/diagram/save
  â†“
AzureDevOpsService.createFile()
  â†“
Azure DevOps Git Commit
```

### 3. Authentication Flow

```
User visits protected route
  â†“
middleware.ts intercepts
  â†“
Checks JWT cookie (encrypted with jose)
  â†“
If invalid â†’ redirect to /login
  â†“
User enters password
  â†“
POST /api/auth/login
  â†“
Validates against WebsitePassword env var
  â†“
Creates JWT session cookie (httpOnly, secure)
  â†“
Redirects to home
```

## ğŸ“Š Data Models

### Core Types ([lib/Types.ts](Website/lib/Types.ts))

```typescript
// Main entity structure
EntityType {
  DisplayName: string
  SchemaName: string
  Group: string | null  // e.g., "Core", "Custom"
  Ownership: "User" | "Organization" | "Team" | "None"
  IsActivity: boolean
  IsCustom: boolean
  Attributes: AttributeType[]      // 10+ polymorphic types
  Relationships: RelationshipType[]
  SecurityRoles: SecurityRole[]
  Keys: Key[]
}

// Polymorphic attribute union
AttributeType =
  | ChoiceAttributeType      // Picklist with options
  | LookupAttributeType      // Foreign key (Targets: string[])
  | StringAttributeType      // Text (MaxLength, Format)
  | DateTimeAttributeType    // Date/Time (Behavior, Format)
  | IntegerAttributeType     // Number (Min, Max, Format)
  | DecimalAttributeType     // Decimal/Money (Precision)
  | BooleanAttributeType     // Two-option (TrueLabel, FalseLabel)
  | StatusAttributeType      // Status with linked State
  | FileAttributeType        // File/Image (MaxSize)
  | GenericAttributeType     // Fallback

// Relationships
RelationshipType {
  Name: string                    // Display name
  RelationshipSchema: string      // Unique identifier
  TableSchema: string             // Related entity
  IsManyToMany: boolean
  CascadeConfiguration: {         // Delete behavior
    Delete: "Cascade" | "RemoveLink" | "Restrict" | null
    Merge: ...
    Reparent: ...
  }
}

// Security
SecurityRole {
  Name: string
  Create/Read/Write/Delete: PrivilegeDepth | null
  Append/AppendTo/Assign/Share: PrivilegeDepth | null
}

PrivilegeDepth = "None" | "Basic" | "Local" | "Deep" | "Global"
```

### Diagram Models ([lib/diagram/models/](Website/lib/diagram/models/))

```typescript
// Persisted diagram format
SerializedDiagram {
  name: string
  entities: SerializedEntity[]
  excludedLinks: ExcludedLinkMetadata[]
  zoom: number
  translate: { x: number, y: number }
}

SerializedEntity {
  entitySchemaName: string
  position: { x: number, y: number }
  size: { width: number, height: number }
  label?: string  // Custom display name
}

// Relationship metadata stored on links
RelationshipInformation {
  relationshipSchemaName: string
  lookupDisplayName: string
  isManyToMany: boolean
  isSourceEntity: boolean  // Direction indicator
}
```

## ğŸ¨ Styling System

**Tailwind CSS 4** with modern syntax:

```css
/* globals.css */
@layer theme, base, mui, components, utilities;
@import 'tailwindcss';

@theme {
  --breakpoint-md: 56.25rem;
  --animate-data-flow: data-flow 2s linear infinite;
}

@layer theme {
  :root {
    --layout-sidebar-desktop-width: 72px;
    --layout-header-desktop-height: 72px;
  }
}
```

**MUI Integration**:
- Uses AppRouterCacheProvider for Next.js 15
- Custom theme in [theme.ts](Website/theme.ts)
- Combines MUI semantic components with Tailwind utilities

```tsx
// Component pattern
<Box className="rounded-2xl flex w-full bg-cover">
  <Typography variant="h1" className="text-4xl font-bold">
```

## ğŸ”§ Build & Deployment

### Local Development

```bash
# Generator
cd Generator
dotnet restore
dotnet build --configuration Release
dotnet run --OutputFolder ../Website/generated

# Website
cd Website
npm install
npm run dev  # Next.js dev server on port 3000
```

### Production Build

```bash
# Full pipeline
dotnet build --configuration Release
dotnet run --project Generator/Generator.csproj --OutputFolder Website/generated
cd Website
npm install
npm run prepipeline  # Copy stub files if needed
npm run build        # Next.js standalone build
npm run postbuild    # Prepare deployment bundle
```

**Output**: [Website/.next/standalone/](Website/.next/standalone/) â†’ Deploy to Azure App Service

### CI/CD Pipeline

1. **Build** ([azure-pipelines-build-jobs.yml](azure-pipelines-build-jobs.yml))
   - Build Generator (.NET 8)
   - Run Generator â†’ create Data.ts
   - Download Wiki content (optional)
   - Build Next.js app
   - Create WebApp.zip artifact

2. **Deploy** ([azure-pipelines-deploy-jobs.yml](azure-pipelines-deploy-jobs.yml))
   - Deploy Bicep template â†’ App Service + Managed Identity
   - Deploy WebApp.zip
   - Set startup command: `node server.js`

## ğŸ” Configuration

### Generator ([Generator/appsettings.local.json](Generator/appsettings.local.json))

```json
{
  "DataverseUrl": "https://org.crm4.dynamics.com",
  "DataverseSolutionNames": "Solution1,Solution2"
}
```

### Website ([Website/.env.local](Website/.env.local))

```env
# Authentication
WebsitePassword=<password>
WebsiteSessionSecret=<32-byte-secret>

# Azure DevOps (diagram storage)
ADO_ORGANIZATION_URL=https://dev.azure.com/org
ADO_PROJECT_NAME=ProjectName
ADO_REPOSITORY_NAME=RepoName
ADO_PAT=<personal-access-token>  # Dev only

# Azure
AZURE_CLI_AUTHENTICATION_ENABLED=true  # Dev only
```

## ğŸ§© Critical Components

### DiagramViewContext ([components/diagramview/DiagramViewContext.tsx](Website/components/diagramview/DiagramViewContext.tsx))

**Responsibility**: Central state manager for diagram canvas

**Key State**:
```typescript
{
  graph: dia.Graph | null              // JointJS graph model
  paper: dia.Paper | null              // JointJS paper (canvas)
  entitiesInDiagram: Map<schemaName, EntityType>
  excludedLinks: Set<relationshipSchemaName>
  paperMatrix: DOMMatrix              // Canvas transform (zoom/pan)
}
```

**Key Actions**:
- `addEntity(entity, position)` - Add entity to canvas
- `removeEntity(schemaName)` - Remove entity and cleanup
- `selectEntity(schemaName)` - Update selection state
- `applySmartLayout()` - Auto-arrange entities
- `setExcludedLinks(set)` - Filter relationships

### DiagramEventBridge ([lib/diagram/DiagramEventBridge.ts](Website/lib/diagram/DiagramEventBridge.ts))

**Pattern**: Event bus connecting JointJS (non-React) to React components

```typescript
class DiagramEventBridge {
  private static instance: DiagramEventBridge

  dispatch(eventName: string, detail: any) {
    window.dispatchEvent(new CustomEvent(eventName, { detail }))
  }

  on(eventName: string, callback: (detail: any) => void) {
    window.addEventListener(eventName, (e) => callback(e.detail))
  }
}

// Usage in JointJS view
DiagramEventBridge.getInstance().dispatch('selectObject', {
  type: 'Entity',
  name: entitySchemaName
})

// Usage in React component
useEffect(() => {
  const bridge = DiagramEventBridge.getInstance()
  const handler = (detail) => { /* handle event */ }
  bridge.on('selectObject', handler)
  return () => bridge.off('selectObject', handler)
}, [])
```

### AvoidRouter ([components/diagramview/avoid-router/](Website/components/diagramview/avoid-router/))

**Pattern**: WebAssembly routing in Web Worker

**Files**:
- [worker-thread/worker.ts](Website/components/diagramview/avoid-router/worker-thread/worker.ts) - Worker entry point
- [shared/avoidrouter.ts](Website/components/diagramview/avoid-router/shared/avoidrouter.ts) - Main thread interface
- [shared/initialization.ts](Website/components/diagramview/avoid-router/shared/initialization.ts) - Setup logic

**Flow**:
```
Main Thread: Entity moved
  â†“
AvoidRouter.updateShapes() (debounced)
  â†“
Worker message: { type: 'updateShapes', shapes: [...] }
  â†“
Worker: libavoid calculates routes
  â†“
Worker message: { type: 'routesUpdated', routes: [...] }
  â†“
Main Thread: Update link vertices
```

### EntityElement ([components/diagramview/diagram-elements/EntityElement.ts](Website/components/diagramview/diagram-elements/EntityElement.ts))

**Custom JointJS Element** for Dataverse entities

```typescript
class EntityElement extends dia.Element {
  defaults() {
    return {
      type: 'custom.Entity',
      size: { width: 120, height: 60 },
      attrs: {
        body: { /* rectangle styling */ },
        icon: { /* SVG icon */ },
        label: { /* entity name */ }
      },
      ports: {
        groups: {
          top: { position: 'top' },
          right: { position: 'right' },
          // ... 8 connection points
        }
      }
    }
  }
}

// Custom view for DOM interactions
class EntityElementView extends dia.ElementView {
  events: {
    'contextmenu': 'onContextMenu'
  }

  onContextMenu(evt) {
    DiagramEventBridge.getInstance().dispatch('entityContextMenu', {
      entitySchemaName: this.model.get('entitySchemaName'),
      position: { x: evt.clientX, y: evt.clientY }
    })
  }
}
```

### DatamodelDataContext ([contexts/DatamodelDataContext.tsx](Website/contexts/DatamodelDataContext.tsx))

**Responsibility**: Load and provide entity metadata to entire app

**Loading Strategy**: Web Worker to avoid blocking main thread

```typescript
useEffect(() => {
  const worker = new Worker('/workers/dataLoader.worker.js')
  worker.postMessage({ type: 'LOAD_DATA' })

  worker.onmessage = (e) => {
    if (e.data.type === 'DATA_LOADED') {
      const data = deserializeData(e.data.data)
      setEntityGroups(data.EntityGroups)
      setWarnings(data.Warnings)
      // ...
    }
  }
}, [])
```

## ğŸ” Search & Navigation

### Metadata Browser ([app/metadata/page.tsx](Website/app/metadata/page.tsx))

**Features**:
- Virtual scrolling via @tanstack/react-virtual (handles 1000+ entities)
- Search by entity name/schema name
- Filter by group (Core, Custom, Activity, etc.)
- Detail view with tabs: Attributes, Relationships, Keys, Security

### Process Explorer ([app/processes/page.tsx](Website/app/processes/page.tsx))

**Shows attribute usage in**:
- **Plugins**: Scanned from PluginStep.Configuration and images
- **Power Automate Flows**: Parsed from flow definition JSON
- **Web Resources**: JavaScript code parsed for attribute references

**Use Case**: "Which plugins/flows will break if I delete this attribute?"

## ğŸ“ˆ Insights & Analytics ([app/insights/](Website/app/insights/))

### Compliance Insights ([insights/compliance/page.tsx](Website/app/insights/compliance/page.tsx))

**Charts** (using Nivo):
- **Audit Coverage**: Pie chart of IsAuditEnabled entities
- **Notes Coverage**: Entities with notes enabled
- **Ownership Distribution**: User vs Organization vs Team
- **Custom vs System**: Ratio of custom entities

### Solution Insights ([insights/solutions/page.tsx](Website/app/insights/solutions/page.tsx))

**Features**:
- Solution component breakdown
- Dependency visualization (Chord diagram)
- Warning detection (missing dependencies, circular refs)

## ğŸš€ Deployment

### Azure Resources (Created by [Infrastructure/main.bicep](Infrastructure/main.bicep))

1. **App Service Plan** (F1 Free or scalable SKU)
2. **App Service** with:
   - System Assigned Managed Identity
   - Node 24 LTS runtime
   - Environment variables from pipeline

### Required Azure Configuration

**Managed Identity Permissions**:
- Must have "Basic" read access to Dataverse environment
- Must have Contributor access to ADO repository (for diagram storage)

**Environment Variables** (set in pipeline):
- `WebsitePassword` - Login password
- `WebsiteSessionSecret` - JWT encryption key
- `ADO_ORGANIZATION_URL`, `ADO_PROJECT_NAME`, `ADO_REPOSITORY_NAME`
- (No PAT in production - uses Managed Identity)

## ğŸ› ï¸ Common Tasks

### Add New Attribute Type

1. **Generator**: Add DTO in [Generator/DTO/Attributes/](Generator/DTO/Attributes/)
2. **Generator**: Update [DataverseService.cs](Generator/DataverseService.cs) mapping logic
3. **Website**: Add type to [lib/Types.ts](Website/lib/Types.ts) AttributeType union
4. **Website**: Update renderer in [components/datamodelview/attributes/](Website/components/datamodelview/attributes/)

### Add New Diagram Feature

1. **Model**: Update [SerializedDiagram](Website/lib/diagram/models/SerializedDiagram.ts)
2. **Serializer**: Update [DiagramSerializer.ts](Website/lib/diagram/services/DiagramSerializer.ts)
3. **Context**: Add state to [DiagramViewContext.tsx](Website/components/diagramview/DiagramViewContext.tsx)
4. **UI**: Add controls in [components/diagramview/panes/](Website/components/diagramview/panes/)

### Add New API Endpoint

1. Create route in [app/api/](Website/app/api/) (e.g., `app/api/export/route.ts`)
2. Add session check if auth required:
   ```typescript
   const session = await getSession()
   if (!session) return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
   ```
3. Import types from [lib/Types.ts](Website/lib/Types.ts)
4. Return NextResponse with JSON

### Update Generator Query

1. Find query in [Generator/Queries/](Generator/Queries/)
2. Update FetchXML or QueryExpression
3. Run generator locally to test:
   ```bash
   dotnet run --project Generator/Generator.csproj --OutputFolder Website/generated
   ```
4. Verify [Website/generated/Data.ts](Website/generated/Data.ts) output

## ğŸ” Customization Detection

### Standard Field Detection ([MetadataExtensions.cs](Generator/MetadataExtensions.cs))

The application identifies whether attributes are standard (out-of-box) or customized using multiple checks:

**Detection Logic**:

1. **IsCustomAttribute Check**: If `attribute.IsCustomAttribute = true`, it's entirely custom
2. **Display Name/Description Check**: Compares against language-specific defaults (English, Danish)
3. **Choice Options Check** (NEW for statecode/statuscode):
   - Checks if any option in the OptionSet has `IsManaged = false`
   - Unmanaged options indicate custom choices have been added
   - Works reliably for both custom and standard entities

**Implementation**:
```csharp
public static bool StandardFieldHasChanged(
    AttributeMetadata attribute,
    string entityDisplayName,
    bool isCustomEntity)
{
    // Check text changes
    var hasTextChanged = fields.StandardDescriptionHasChanged(...)
        || fields.StandardDisplayNameHasChanged(...);

    // Check option changes for statecode/statuscode
    var hasOptionsChanged = attribute switch
    {
        StateAttributeMetadata state => StateCodeOptionsHaveChanged(state),
        StatusAttributeMetadata status => StatusCodeOptionsHaveChanged(status),
        _ => false
    };

    return hasTextChanged || hasOptionsChanged;
}

private static bool StateCodeOptionsHaveChanged(StateAttributeMetadata state)
{
    // Check if any options are unmanaged (custom)
    return state.OptionSet?.Options?.Any(opt => opt.IsManaged == false) ?? false;
}
```

**Frontend Usage**:
- Fields marked with `IsStandardFieldModified = true` are shown when "Hide standard fields" is OFF
- Enables users to see which entities have custom status/state options added

## ğŸ› Debugging Tips

### Generator Issues

**Connection failures**:
- Check `DataverseUrl` in appsettings.local.json
- Verify Azure CLI logged in: `az login`
- Check DefaultAzureCredential order: Azure CLI â†’ Environment â†’ Managed Identity

**Missing entities**:
- Verify solution names in `DataverseSolutionNames`
- Check if entity is in specified solutions
- Review console output for warnings

### Website Issues

**Diagram not rendering**:
- Check browser console for JointJS errors
- Verify EntityElement registered: `dia.Cell.define('custom.Entity')`
- Check DiagramViewContext initialized (graph, paper not null)

**Routing not working**:
- Check Web Worker loaded: Network tab for `avoidrouter.worker.js`
- Verify libavoid WASM loaded: Console for initialization logs
- Check AvoidRouter state: `routingEnabled` should be true

**Data not loading**:
- Verify [generated/Data.ts](Website/generated/Data.ts) exists (run generator)
- Check DatamodelDataContext state: `isLoading` should eventually be false
- Check Web Worker: Console for worker errors

### Performance Issues

**Slow diagram with many entities**:
- Check entity count (>100 may be slow)
- Disable routing temporarily: AvoidRouter.setRoutingEnabled(false)
- Use Smart Layout sparingly (O(nÂ²) complexity)

**Large Data.ts file**:
- Filter solutions more specifically in Generator
- Check for excessive attributes or relationships
- Consider pagination for metadata browser

## ğŸ“š Related Documentation

- **Next.js 15 Docs**: https://nextjs.org/docs
- **JointJS Docs**: https://resources.jointjs.com/docs/jointjs
- **libavoid**: https://www.adaptagrams.org/documentation/libavoid.html
- **Dataverse SDK**: https://docs.microsoft.com/power-apps/developer/data-platform/
- **Azure Managed Identity**: https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/

## ğŸ”„ Version History

- **2.2.2** (2025-11-05): Current version
- **Branch**: `patches/12187-diverse`
- **Main Branch**: `main`

---

**Last Updated**: 2025-11-06
**Generated By**: Claude Code Analysis
